(function(s,u,o){"use strict";function p(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function h(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function w(n,t,e){return t&&h(n.prototype,t),e&&h(n,e),n}function m(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}const y=o.findByProps("show","confirm","close"),b=o.findByProps("addRelationship"),v=o.findByProps("handleStartCall"),$=o.findByProps("hideActionSheet");var C=new(function(){function n(){p(this,n),m(this,"patches",[])}return w(n,[{key:"onLoad",value:function(){var t=this;this.patches.push(u.patcher.instead("handleStartCall",v,function(e,r){const[{rawRecipients:[{username:i,discriminator:l},a]},f]=e,c=f?"video call":"call";y.show({title:a?`Start a group ${c}?`:`Start a ${c} with ${i}#${l}?`,body:a?"Are you sure you want to start the group call?":`Are you sure you want to ${c} ${i}#${l}?`,confirmText:"Yes",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){try{r(...e)}catch(d){u.logger.error("Failed to start call",d)}}})})),this.patches.push(u.patcher.instead("addRelationship",b,function(e,r){if(typeof e[0]!="object"||!e[0].userId)return r.apply(t,e);const{username:i,discriminator:l}=o.findByStoreName("UserStore").getUser(e[0].userId),a=setInterval(function(){return $.hideActionSheet()},100);setTimeout(function(){return clearInterval(a)},3e3);const f=e[0].type===2;return new Promise(function(c){y.show({title:`${f?"Block":"Friend"} ${i}#${l}?`,body:`Are you sure you want to ${f?"block":"friend"} ${i}#${l}?`,confirmText:"Yes",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){try{c(r.apply(t,e))}catch(d){u.logger.error("Failed to add relationship",d)}finally{clearInterval(a)}},onCancel:function(){return void clearInterval(a)}})})}))}},{key:"onUnload",value:function(){for(const t of this.patches)t()}}]),n}());return s.default=C,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta,vendetta.metro);
